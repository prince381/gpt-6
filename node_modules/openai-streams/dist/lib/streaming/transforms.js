import{ENCODER as i,DECODER as d}from"../../globs/shared.js";import{OpenAIError as c}from"../errors.js";const a=o=>{const e=o?.choices?.[0];if(!e)throw console.error("No choices received from OpenAI"),new c("UNKNOWN");const r=e?.text??e?.message;if(typeof r!="string")throw console.error("No text received from OpenAI choice"),new c("UNKNOWN");return r},m=async function*(o){const e=d.decode(o),n=JSON.parse(e)?.choices?.[0]?.delta;if(typeof n!="object")throw console.error("Received invalid delta from OpenAI in ChatParser."),new c("UNKNOWN");const t=JSON.stringify(n);yield i.encode(t)},l=async function*(o){const e=d.decode(o),r=JSON.parse(e),s=a(r);yield i.encode(s)},E=async function*(o){const e=new TextEncoder,s=new TextDecoder().decode(o),n=JSON.parse(s),{logprobs:t}=n?.choices?.[0];t&&(yield e.encode(JSON.stringify(t)))};export{m as ChatParser,E as LogprobsParser,l as TokenParser,a as getTokensFromResponse};
